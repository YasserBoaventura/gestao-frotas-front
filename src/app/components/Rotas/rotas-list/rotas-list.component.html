<div class="rotas-container">
  <!-- Header -->
  <div class="header">
    <div class="header-title">
      <i class="bi bi-geo-alt title-icon"></i>
      <div>
        <h1 class="h3 mb-1">Gest√£o de Rotas</h1>
        <p class="text-muted mb-0">Gerencie as rotas dispon√≠veis para viagens</p>
      </div>
    </div>
    <div class="header-actions">
      <button class="btn-reload" (click)="carregarRotas()">
        <i class="bi bi-arrow-clockwise"></i> Atualizar
      </button>
      <button class="btn-add" (click)="abrirModalCriar()">
        <i class="bi bi-plus-circle"></i> Nova Rota
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="search-section">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">
          <i class="bi bi-funnel me-2"></i>Filtros de Busca
        </h5>
        <p class="card-text">Encontre rotas espec√≠ficas usando os filtros abaixo</p>

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Origem</label>
            <div class="input-group">
              <span class="input-group-text">
                <i class="bi bi-geo-alt"></i>
              </span>
              <input type="text" class="form-control"
                     [(ngModel)]="filtro.origem"
                     placeholder="Filtrar por origem...">
            </div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Destino</label>
            <div class="input-group">
              <span class="input-group-text">
                <i class="bi bi-geo-alt-fill"></i>
              </span>
              <input type="text" class="form-control"
                     [(ngModel)]="filtro.destino"
                     placeholder="Filtrar por destino...">
            </div>
          </div>
        </div>

        <small class="form-text">
          <i class="bi bi-info-circle me-1"></i>
          Use os campos acima para refinar sua busca. Deixe em branco para ver todas as rotas.
        </small>
      </div>
    </div>
  </div>

  <!-- Tabela -->
  <div class="table-container">
    <div class="table-header-info">
      <div class="d-flex justify-content-between align-items-center">
        <div class="total-registros">
          Total: <strong>{{ rotasFiltradas.length }}</strong> rotas encontradas
        </div>
        <div class="export-actions">
          <button class="btn btn-sm btn-outline-secondary" (click)="exportarParaCSV()">
            <i class="bi bi-download me-1"></i> Exportar
          </button>
        </div>
      </div>
    </div>

    <table class="rotas-table">
      <thead>
        <tr>
          <th class="id-cell">ID</th>
          <th>Origem</th>
          <th>Destino</th>
          <th>Dist√¢ncia</th>
          <th>Tempo</th>
          <th>Descri√ß√£o</th>
          <th>Viagens</th>
          <th class="actions-header">A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let rota of rotasFiltradas; let i = index" class="table-row">
          <td class="id-cell">{{ rota.id }}</td>
          <td class="rota-origem-cell">
            <i class="bi bi-geo-alt text-primary me-2"></i>
            {{ rota.origem }}
          </td>
          <td class="rota-destino-cell">
            <i class="bi bi-geo-alt-fill text-success me-2"></i>
            {{ rota.destino }}
          </td>
          <td>
            <span class="distancia-badge">
              {{ rota.distanciaKm | number:'1.0-0' }} km
            </span>
          </td>
          <td>
            <span class="tempo-badge">
              {{ rota.tempoEstimadoHoras }}h
            </span>
          </td>
          <td class="descricao-cell" [title]="rota.descricao">
            {{ rota.descricao || 'Sem descri√ß√£o' }}
          </td>
          <td>
            <span class="viagens-badge" [ngClass]="getViagensBadgeClass( 0)">
              {{ rota.totalViagens }}
            </span>
          </td> 
          <td class="actions-cell">
            <button class="btn-edit" (click)="abrirModalEditar(rota)" title="Editar">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn-delete" (click)="excluirRota(rota.id)" title="Excluir">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>

        <!-- Estado Vazio -->
        <tr *ngIf="rotasFiltradas.length === 0">
          <td colspan="8">
            <div class="empty-state">
              <i class="bi bi-inbox empty-icon"></i>
              <h3>Nenhuma rota encontrada</h3>
              <p>N√£o encontramos rotas com os filtros atuais.</p>
              <button class="btn-add-empty" (click)="abrirModalCriar()">
                <i class="bi bi-plus-circle"></i> Cadastrar Primeira Rota
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal (mantenha o mesmo) -->
<!-- ... -->




        <div class="card-footer bg-white border-0 py-3">
          <div class="row align-items-center">
            <div class="col-md-6">
              <p class="mb-0 text-muted">
                Mostrando <strong>{{ rotasFiltradas.length }}</strong> de <strong>{{ rotas?.length || 0 }}</strong> rotas
              </p>
            </div>
            <div class="col-md-6">
              <nav class="d-flex justify-content-md-end">
                <ul class="pagination mb-0">
                  <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1">Anterior</a>
                  </li>
                  <li class="page-item active"><a class="page-link" href="#">1</a></li>
                  <li class="page-item"><a class="page-link" href="#">2</a></li>
                  <li class="page-item"><a class="page-link" href="#">3</a></li>
                  <li class="page-item">
                    <a class="page-link" href="#">Pr√≥xima</a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>

<!-- Modal Cadastro/Edi√ß√£o -->
<div class="modal fade" id="modalRota" [class.show]="mostrarModal"
     [style.display]="mostrarModal ? 'block' : 'none'" tabindex="-1"
     [attr.aria-hidden]="!mostrarModal">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg animate-modal">
      <div class="modal-header bg-gradient-primary text-white">
        <h5 class="modal-title">
          <i class="bi bi-geo-alt me-2"></i>
          {{ modoEdicao ? 'Editar Rota' : 'Nova Rota' }}
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="fecharModal()"></button>
      </div>
      <div class="modal-body p-4">
        <form #rotaForm="ngForm" (ngSubmit)="salvarRota()">
          <!-- Rota Visual -->
          <div class="route-visualization mb-4 p-3 bg-light rounded-3">
            <div class="d-flex align-items-center justify-content-between">
              <div class="text-center flex-grow-1">
                <div class="fs-1 mb-2">üìç</div>
                <input type="text" class="form-control form-control-lg text-center fw-bold border-0 bg-transparent"
                       [(ngModel)]="rotaSelecionada.origem"
                       name="origem"
                       required
                       placeholder="ORIGEM">
              </div>
              <div class="mx-4">
                <div class="route-arrow">
                  <i class="bi bi-arrow-right fs-1 text-primary"></i>
                  <div class="small text-muted mt-2">{{ rotaSelecionada.distanciaKm || 0 }} km</div>
                </div>
              </div>
              <div class="text-center flex-grow-1">
                <div class="fs-1 mb-2">üèÅ</div>
                <input type="text" class="form-control form-control-lg text-center fw-bold border-0 bg-transparent"
                       [(ngModel)]="rotaSelecionada.destino"
                       name="destino"
                       required
                       placeholder="DESTINO">
              </div>
            </div>
          </div>

          <div class="row g-3">
            <!-- Dist√¢ncia e Tempo -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">
                <i class="bi bi-signpost me-1"></i>Dist√¢ncia (km) *
              </label>
              <div class="input-group input-group-lg">
                <span class="input-group-text bg-light">
                  <i class="bi bi-rulers"></i>
                </span>
                <input type="number" class="form-control"
                       [(ngModel)]="rotaSelecionada.distanciaKm"
                       name="distanciaKm"
                       required
                       min="1"
                       step="0.1"
                       placeholder="Ex: 429">
                <span class="input-group-text">km</span>
              </div>
            </div>

            <div class="col-md-6">
              <label class="form-label fw-semibold">
                <i class="bi bi-clock me-1"></i>Tempo Estimado *
              </label>
              <div class="input-group input-group-lg">
                <span class="input-group-text bg-light">
                  <i class="bi bi-stopwatch"></i>
                </span>
                <input type="number" class="form-control"
                       [(ngModel)]="rotaSelecionada.tempoEstimadoHoras"
                       name="tempoEstimadoHoras"
                       required
                       min="0.5"
                       step="0.5"
                       placeholder="Ex: 6.5">
                <span class="input-group-text">horas</span>
              </div>
            </div>

            <!-- Descri√ß√£o -->
            <div class="col-12">
              <label class="form-label fw-semibold">
                <i class="bi bi-card-text me-1"></i>Descri√ß√£o da Rota
              </label>
              <textarea class="form-control"
                        [(ngModel)]="rotaSelecionada.descricao"
                        name="descricao"
                        rows="4"
                        placeholder="Descreva detalhes da rota, pontos de interesse, condi√ß√µes especiais..."></textarea>
            </div>

            <!-- Informa√ß√µes Adicionais -->
            <div class="col-12" *ngIf="modoEdicao">
              <div class="alert alert-info bg-opacity-10 border-info">
                <div class="d-flex">
                  <div class="flex-shrink-0">
                    <i class="bi bi-info-circle-fill text-info fs-4"></i>
                  </div>
                  <div class="ms-3">
                    <h6 class="alert-heading">Informa√ß√µes da Rota</h6>
                    <p class="mb-0">
                      Esta rota possui <strong>{{ rotaSelecionada || 0 }}</strong> viagem(ns) associada(s).
                      Altera√ß√µes podem afetar essas viagens.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="modal-footer mt-4 border-0 pt-3">
            <button type="button" class="btn btn-outline-secondary" (click)="fecharModal()">
              <i class="bi bi-x-lg me-2"></i>Cancelar
            </button>
           <button type="submit" class="btn btn-primary">
        <i class="bi bi-check-lg me-2"></i>
        {{ modoEdicao ? 'Atualizar' : 'Salvar' }}
        </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal-backdrop fade" [class.show]="mostrarModal"
     [style.display]="mostrarModal ? 'block' : 'none'"></div>

<!-- Toast de Notifica√ß√£o -->
<div class="toast-container position-fixed top-0 end-0 p-3">
  <div id="successToast" class="toast align-items-center text-white bg-success border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body">
        <i class="bi bi-check-circle me-2"></i>
        Opera√ß√£o realizada com sucesso!
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="footer mt-5 py-4 bg-light border-top">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="rodape">
        <p class="mb-0 text-muted">
          ¬© 2024 Sistema de Gest√£o de Rotas. Todos os direitos reservados.
        </p>
      </div>
      <div class="col-md-6 text-md-end">
        <span class="text-muted small">
          <i class="bi bi-code-slash me-1"></i>
      Pixel Sotware
        </span>
      </div>
    </div>
  </div>
</footer>
